# üß© Dishka Manifest: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ Python-–ø—Ä–æ–µ–∫—Ç

## üìò –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**Dishka** ‚Äî —ç—Ç–æ –ª—ë–≥–∫–∏–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Dependency Injection (DI) –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Python, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∏ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —É–ø—Ä–æ—â–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º.

Dishka –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏:
- FastAPI
- aiohttp
- Telegram bots

---

## üéØ –¶–µ–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –∏—Ö —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –ø–æ–¥–º–µ–Ω—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ß–∏—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ Python-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üõ† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

### üì¶ –ì–¥–µ —Ä–∞–∑–º–µ—â–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `infrastructure/di.py` ‚Äî —ç—Ç–æ –±—É–¥–µ—Ç —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```python
from dishka import Provider, Scope
from infrastructure.db.mongo import get_mongo_client
from infrastructure.kafka.producer import get_kafka_producer

provider = Provider(scope=Scope.APP)
provider.provide(get_mongo_client)
provider.provide(get_kafka_producer)
provider.provide(get_db_session)
```

## üß† –ö–∞–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–§—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—é—Ç –æ–±—ä–µ–∫—Ç—ã, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã:

```python
from typing import AsyncGenerator
from sqlalchemy.ext.asyncio import AsyncSession
from contextlib import asynccontextmanager
from app.core.db.db_init import SessionFactory

@asynccontextmanager
async def get_db_session() -> AsyncGenerator[AsyncSession, None]:
    async with SessionFactory() as session:
        yield session
```


## üß† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ

```python
# application/services/user_service.py
from dishka import inject, FromDishka
from sqlalchemy.ext.asyncio import AsyncSession

@inject
class UserService:
    def __init__(self, session: AsyncSession = FromDishka()):
        self.session = session

    async def get_user(self, user_id: int):
        result = await self.session.execute(
            select(UserModel).where(UserModel.id == user_id)
        )
        return result.scalar_one_or_none()
```


## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —à–∞–±–ª–æ–Ω (TDD + Clean Architecture)


  src/
‚îú‚îÄ‚îÄ api/                # –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏: —Ä–æ—É—Ç—ã, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îî‚îÄ‚îÄ routers/
‚îÇ   ‚îî‚îÄ‚îÄ schemas/
‚îÇ
‚îú‚îÄ‚îÄ application/        # Use-cases, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ interfaces/
‚îÇ
‚îú‚îÄ‚îÄ domain/             # –°—É—â–Ω–æ—Å—Ç–∏, value objects
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ schemas/
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/     # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤: –ë–î, Kafka, Redis
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ kafka/
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îî‚îÄ‚îÄ di.py

## üí° –ü—Ä–∏–º–µ—Ä—ã –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫
### üîß –ò–Ω—ä–µ–∫—Ü–∏—è –≤ —Å–µ—Ä–≤–∏—Å


```python
from dishka import inject, FromDishka
from motor.motor_asyncio import AsyncIOMotorClient
from aiokafka import AIOKafkaProducer

@inject
class UserService:
    def __init__(
        self,
        db: AsyncIOMotorClient = FromDishka(),
        kafka: AIOKafkaProducer = FromDishka()
    ):
        self.db = db
        self.kafka = kafka

```

### üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI


```python
from fastapi import FastAPI
from dishka.integrations.fastapi import setup_dishka, DishkaRoute
from infrastructure.di import provider

app = FastAPI()
setup_dishka(app, provider=provider, route_class=DishkaRoute)

```

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–¥–º–µ–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```python
from dishka import Provider

test_provider = Provider()
test_provider.provide(lambda: MockKafkaProducer())
test_provider.provide(lambda: FakeMongoClient())

# –ò—Å–ø–æ–ª—å–∑—É–π test_provider –≤ —Ç–µ—Å—Ç–æ–≤–æ–º FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
Dishka ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≥–¥–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ, –∫–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∏—â–µ, –∞ —Ç–µ—Å—Ç—ã ‚Äî –ø—Ä–æ—â–µ. –í–Ω–µ–¥—Ä—è–π Dishka —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞, –∏ —Ç—ã –∏–∑–±–µ–∂–∏—à—å –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ª–æ–≤—É—à–µ–∫.

      
